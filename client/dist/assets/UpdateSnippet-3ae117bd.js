import{r as s,_ as f,u as V,k as v,b,j as a}from"./index-94fca464.js";import{b as B,C as N,L,Q as R}from"./App-ff4ff5eb.js";import{b as p}from"./browser-993d398e.js";import{p as d,a as O,u as g}from"./queryKeyFactory-17eee966.js";import{u as k,c as D,a as _,b as M,o as G}from"./yup-3e96ae65.js";import{p as H,b as z,a as A}from"./post-039f65a6.js";import{j as J}from"./auth-89fb04be.js";import{u as K}from"./useQuery-8baaa080.js";const S=s.lazy(()=>f(()=>import("./loader-a290854d.js"),["assets/loader-a290854d.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css"])),Q=s.lazy(()=>f(()=>import("./updateForm-d9184a71.js"),["assets/updateForm-d9184a71.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/Form-01d6657c.js","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css","assets/index-090fa6c0.js","assets/createWithBsPrefix-2e1af6a5.js","assets/Col-8e5ef79d.js","assets/Row-e15797d1.js","assets/Button-cc906282.js","assets/Button-0a6dc675.js"])),W=s.lazy(()=>f(()=>import("./updated-bb61ef58.js"),["assets/updated-bb61ef58.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css","assets/Badge-e5f34967.js","assets/index-a9f93b6b.js","assets/index-090fa6c0.js","assets/Col-8e5ef79d.js","assets/Row-e15797d1.js"])),se=()=>{var h,j,E,P,q;const n=V(),{id:c}=B(),U={}.VITE_BASE_URL,x=v(H),u=v(z),$=b(J),e=b(z),i=K([(h=d)==null?void 0:h.detail(c),c],()=>{var t;return(t=A)==null?void 0:t.getPostById(c)}),r=K({queryKey:(j=d)==null?void 0:j.all,queryFn:(E=A)==null?void 0:E.getAll}),m=k({mutationFn:async t=>await O.patch(`${U}/api/post/${c}`,t,{withCredentials:!0,headers:{Authorization:`Bearer ${$}`,"Content-Type":"application/json"}}),onSuccess:()=>{l(),n.invalidateQueries({queryKey:d.details()}),n.invalidateQueries({queryKey:d.lists()}),n.invalidateQueries({queryKey:g.details()}),n.invalidateQueries({queryKey:g.lists()}),n.invalidateQueries({queryKey:d.detail(e==null?void 0:e.id)})}}),C=D({title:_().min(5).default(e==null?void 0:e.title).notRequired(),description:_().min(10).default(e==null?void 0:e.description).notRequired(),entry:_().min(10).required().default(e==null?void 0:e.entry).notRequired()}),{register:F,handleSubmit:w,reset:l,formState:{errors:I}}=M({resolver:G(C),mode:"all"});s.useEffect(()=>{let t={};t.title=e==null?void 0:e.title,t.description=e==null?void 0:e.description,t.entry=e==null?void 0:e.entry,l({...t})},[e==null?void 0:e.description,e==null?void 0:e.entry,e==null?void 0:e.title,l]),s.useEffect(()=>{let t=!0;return(async()=>{r!=null&&r.data&&t&&x(r==null?void 0:r.data)})(),()=>{t=!1}},[r.data,x]),s.useEffect(()=>{let t=!0;return(async()=>{i!=null&&i.data&&t&&u(i==null?void 0:i.data)})(),()=>{t=!1}},[i==null?void 0:i.data,u]);const T=async t=>{try{const o={title:p.sanitize(t.title),description:p.sanitize(t.description),entry:p.sanitize(t.entry)},y=await m.mutateAsync(o);y&&(R.success(y.data.message,{theme:"colored"}),u(y.data.post))}catch(o){R.error(o.response.data.error,{theme:"colored"})}};return m.isLoading||i.isLoading||r.isLoading?a.jsx(S,{}):i.isFetching||r.isFetching?a.jsx(S,{}):a.jsxs(N,{className:"col-md-9 mx-auto",children:[a.jsx("h2",{children:"Update Snippet "}),a.jsxs("p",{children:["Update snippet:"," ",a.jsx(L,{to:`/snippet/${e==null?void 0:e.id}`,className:"text-primary",children:e==null?void 0:e.title})]}),a.jsxs("p",{children:["Posted by:"," ",a.jsx(L,{to:`/user/${(P=e==null?void 0:e.user)==null?void 0:P.id}`,className:"text-primary",children:(q=e==null?void 0:e.user)==null?void 0:q.username})]}),a.jsx("p",{children:"All fields are optional."}),a.jsx(Q,{register:F,handleSubmit:w,onSubmit:T,errors:I,reset:l,updateMutation:m}),a.jsx("div",{children:a.jsx(W,{post:e})})]})};export{se as default};
