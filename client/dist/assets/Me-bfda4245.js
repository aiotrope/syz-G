import{r as l,_ as y,u as N,k,b as K,e as B,j as t}from"./index-94fca464.js";import{c as b,a as v,e as J,b as U,u as _,o as F}from"./yup-3e96ae65.js";import{C as j}from"./Col-8e5ef79d.js";import{I as W}from"./Image-821c04f8.js";import{R as A}from"./Row-e15797d1.js";import{C as Z,Q as u}from"./App-ff4ff5eb.js";import{h as L}from"./moment-fbc5633a.js";import{o as G}from"./jwt-decode.esm-9c18df67.js";import{u as f}from"./user-94e43fdc.js";import{u as S,j as w}from"./auth-89fb04be.js";import{u as i,p as h}from"./queryKeyFactory-17eee966.js";import{u as M}from"./useQuery-8baaa080.js";import"./index-090fa6c0.js";const H=a=>new Promise((m,e)=>{const c=new FileReader;c.readAsDataURL(a),c.onload=()=>{m(c.result)},c.onerror=d=>{e(d)}}),X=/^[a-zA-Z0-9$&+,:;=?@#|'<>.^*()%!-{}€"'ÄöäÖØÆ`~_]{4,}$/,ee=l.lazy(()=>y(()=>import("./updateForm-8a2cc68f.js"),["assets/updateForm-8a2cc68f.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/Form-01d6657c.js","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css","assets/index-090fa6c0.js","assets/createWithBsPrefix-2e1af6a5.js","assets/Col-8e5ef79d.js","assets/Button-cc906282.js","assets/Button-0a6dc675.js"])),te=l.lazy(()=>y(()=>import("./updateAvatarForm-fb3edfa3.js"),["assets/updateAvatarForm-fb3edfa3.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/Form-01d6657c.js","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css","assets/index-090fa6c0.js","assets/createWithBsPrefix-2e1af6a5.js","assets/Col-8e5ef79d.js","assets/Button-cc906282.js","assets/Button-0a6dc675.js"])),se=l.lazy(()=>y(()=>import("./updateDestroySnippetsCreated-08afd9b1.js"),["assets/updateDestroySnippetsCreated-08afd9b1.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css","assets/ListGroup-528c8029.js","assets/Nav-e2a94351.js","assets/objectWithoutPropertiesLoose-6c5c234b.js","assets/Button-0a6dc675.js","assets/Badge-e5f34967.js","assets/queryKeyFactory-17eee966.js"])),ae=l.lazy(()=>y(()=>import("./accountDeletion-1da54b76.js"),["assets/accountDeletion-1da54b76.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/Button-cc906282.js","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css","assets/Button-0a6dc675.js"])),re=l.lazy(()=>y(()=>import("./loader-a290854d.js"),["assets/loader-a290854d.js","assets/index-94fca464.js","assets/index-61b77ebf.css","assets/App-ff4ff5eb.js","assets/App-36b8f6be.css"])),xe=()=>{var E;const a=N(),m=k(S),e=K(S),c=K(w),d=G(c),C=B(w),o=M({queryKey:i.detail(d.id),queryFn:f.getMe});l.useEffect(()=>{let s=!0;return(async()=>{o!=null&&o.data&&s&&m({...o==null?void 0:o.data})})(),()=>{s=!1}},[m,o==null?void 0:o.data]);const P=b({username:v().trim().matches(X).default(e.username).notRequired(),email:v().email().default(e.email).notRequired(),bio:v().default(e.bio).notRequired()}),Q=b({image:J().notRequired().nullable()}),{register:Y,handleSubmit:$,reset:x,formState:{errors:I}}=U({resolver:F(P),mode:"all"}),g=U({resolver:F(Q),mode:"onChange"});l.useEffect(()=>{let s={};s.username=e.username,s.email=e.email,s.bio=e.bio,x({...s})},[x,e.bio,e.email,e.username]);const q=_({mutationFn:f.updateUser,onSuccess:()=>{x(),a.invalidateQueries({queryKey:i.detail(d.id)}),a.invalidateQueries({queryKey:i.details()}),a.invalidateQueries({queryKey:i.lists()}),a.invalidateQueries({queryKey:h.details()}),a.invalidateQueries({queryKey:h.lists()})}}),R=_({mutationFn:f.updateUserAvatar,onSuccess:()=>{g.reset(),a.invalidateQueries({queryKey:i.detail(d.id)}),a.invalidateQueries({queryKey:i.details()}),a.invalidateQueries({queryKey:i.lists()}),a.invalidateQueries({queryKey:h.details()}),a.invalidateQueries({queryKey:h.lists()})}}),D=_({mutationFn:f.deleteUserAccount,onSuccess:()=>{a.removeQueries({queryKey:i.detail(d.id)}),u.info(`${e.email} account deleted`,{theme:"colored"}),C()}}),z=async s=>{var p,n;try{const r=await q.mutateAsync(s);r&&(console.log(r==null?void 0:r.user),u.success(r==null?void 0:r.message,{theme:"colored"}),m(r.user))}catch(r){u.error((n=(p=r==null?void 0:r.response)==null?void 0:p.data)==null?void 0:n.error,{theme:"colored"})}},T=async s=>{const p=await H(s.image[0]);try{const n=await R.mutateAsync({image:p});n&&(u.success(n.message,{theme:"colored"}),m(n.user))}catch(n){u.error(n.response.data.error,{theme:"colored"})}},V=async()=>{try{await D.mutateAsync(e.id)}catch(s){u.error(s.response.data.error,{theme:"colored"})}},O=(E=e==null?void 0:e.posts)==null?void 0:E.find(s=>s.user===d.id);return q.isLoading||R.isLoading||M.isLoading||o.isFetching||D.isLoading?t.jsx(re,{}):t.jsxs(Z,{className:"col-md-8 mx-auto",children:[t.jsxs(A,{children:[t.jsx("div",{children:t.jsxs("h2",{children:[t.jsx("span",{className:"text-secondary",children:e.username})," Profile"]})}),t.jsx(j,{className:"my-4",children:t.jsx(W,{src:e==null?void 0:e.avatar,alt:`Profile photo of ${e.username}`,thumbnail:!0,height:80,width:80})})]}),t.jsx(A,{children:t.jsxs(j,{md:"auto",children:[t.jsxs("p",{children:["Created: ",L(e==null?void 0:e.createdAt).format("DD.MM.YYYY, h:mm:ss a")]}),t.jsxs("p",{children:["Updated: ",L(e==null?void 0:e.updatedAt).format("DD.MM.YYYY, h:mm:ss a")]})]})}),t.jsx("h3",{children:"Update your profile"}),t.jsx(ee,{register:Y,handleSubmit:$,onSubmit:z,user:e,errors:I}),t.jsx(te,{onAvatarFormSubmit:T,avatarForm:g}),t.jsx("hr",{}),t.jsx(A,{children:t.jsxs(j,{children:[t.jsx("h5",{children:"Snippets created"}),O&&t.jsx(se,{user:e,queryClient:a,useMutation:_,postKeys:h,userKeys:i,access:c})]})}),t.jsx("hr",{}),t.jsxs("div",{className:"my-5 d-grid gap-2",children:[t.jsx("h6",{children:"Account Deletion"}),t.jsx(ae,{handleDeleteAccount:V})]})]})};export{xe as default};
